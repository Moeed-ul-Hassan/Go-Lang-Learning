# ðŸƒ Module 05: Database Mastery (MongoDB & Go)

Welcome to the core of backend engineering. In this module, we transition from volatile memory to persistent, scalable data storage. This is where your applications become "real."

---

## ðŸ“š Key Definitions

| Term | Definition | SQL Equivalent |
| :--- | :--- | :--- |
| **NoSQL** | Non-relational database designed for scale and flexibility. | RDBMS (SQL) |
| **BSON** | Binary JSON. The high-performance format Mongo uses to store data. | Data Types |
| **Collection** | A grouping of documents. | Table |
| **Document** | A single record (JSON-like object). | Row |
| **Field** | A key-value pair within a document. | Column |
| **ObjectID** | A unique 12-byte identifier generated by Mongo. | Primary Key |

---

## ðŸŽ¯ Strategies for Success

1.  **Connection Pooling**: 
    - **Strategy**: Create a single `mongo.Client` instance and share it across your application.
    - **Why**: Opening a new connection for every request is expensive and will crash your server under load.

2.  **Context-Aware Programming**:
    - **Strategy**: Always use `context.Context` with timeouts (e.g., 10 seconds).
    - **Why**: If the database is down or slow, you don't want your API to hang forever.

3.  **Environment Isolation**:
    - **Strategy**: Use `.env` files and `os.Getenv()` for connection strings.
    - **Why**: Hardcoding passwords in `main.go` is a major security risk.

4.  **Graceful Shutdown**:
    - **Strategy**: Use `defer client.Disconnect(ctx)` in your main function.
    - **Why**: Leaves the database in a clean state and prevents connection leaks.

---

## âŒ Common Misconceptions

> [!WARNING]
> **"NoSQL means No Schema"**
> While Mongo is flexible, "Schema-less" is a trap. You should still define strict Go structs to ensure your data remains consistent.

> [!IMPORTANT]
> **"MongoDB is only for small projects"**
> MongoDB powers giants like Forbes, Toyota, and EA. It is built for massive, distributed scale.

> [!CAUTION]
> **"I can just use `json` tags for everything"**
> Mongo uses **BSON**. While they look similar, you must use `bson:"key"` tags to map Go structs to the database correctly.

---

## ðŸš€ Pro-Level Approaches (Better Ways)

### 1. The Singleton Pattern
Instead of passing the database object everywhere, create a package-level variable or a helper function that returns the established connection.

### 2. The Repository Pattern
Keep your database queries in a separate file (e.g., `repository.go`). Your API handlers should only call functions like `repo.SaveUser(user)`, not raw Mongo queries.

### 3. Proper Struct Mapping
Always include the `omitempty` tag for IDs when creating new records so Mongo can generate them for you.
```go
type User struct {
    ID    primitive.ObjectID `json:"id" bson:"_id,omitempty"`
    Name  string             `json:"name" bson:"name"`
}
```

---
> [!TIP]
> **Mastering MongoDB is the bridge between being a "coder" and becoming a "System Architect". Let's build something stable.**
